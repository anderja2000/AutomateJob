<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>job search</title>
    <link rel="stylesheet" href="interface.css" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fjalla+One&display=swap"
      rel="stylesheet"
    />
    <script
      src="https://kit.fontawesome.com/e8756853c9.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- FONT to be used for headers and such  -->
  </head>

  <body>
    <div class="content">
      <div class="header">
        <div class="icons"></div>

        <h1>Automate Job search</h1>
        <div class="icons"></div>
      </div>
      <form id="searchForm">
        <div class="form-container">
          <div class="form-group" id="attributes">
            <div class="row">
              <label class="title" for="jobTitle">Job Title:</label>
              <input type="text" id="jobTitle" name="jobTitle" required />
            </div>
            <div class="row">
              <label class="title" for="location">Location:</label>
              <input type="text" id="location" name="location" required />
            </div>
          </div>
          <div class="row centered">
            <button type="submit">submit</button>
          </div>
        </div>
      </form>
    </div>

    

    <script src="public.js"></script>
    <script type="module">
      // importing the database created in firebase-config.js
      // import {db} from './firebase-config.js';
      import {
        collection,
        addDoc,
        serverTimestamp,
      } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

      console.log("hi");
      let title, jobLocation;
      function logInputValues() {
        // Select all input elements
        const inputs = document.querySelectorAll("input");

        // Loop through each input
        inputs.forEach((input) => {
          if (input.type === "text") {
            if (input.name === "jobTitle") {
              title = input.value;
            } else if (input.name === "location") {
              jobLocation = input.value;
            }
          }
        });
      }

      document
        .getElementById("searchForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();
          console.log("Form submission prevented");
          logInputValues();
          console.log(`title: ${title} : location: ${jobLocation}`);

          try {
            const response = await axios.post("/api/search-and-store-jobs", {
              jobTitle: title,
              location: jobLocation,
            });
            console.log("Server response:", response.data);

            if (response.data.jobs) {
              console.log("Jobs received from server:", response.data.jobs);
              // You can process or display the jobs data here
            }

            alert("Jobs fetched and stored successfully");
          } catch (error) {
            console.error("Error:", error);
            alert("An error occurred. Please try again.");
          }
        }); 
    </script>
  </body>
</html>
